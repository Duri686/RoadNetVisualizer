<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RoadNet Visualizer - 多层道路网络可视化</title>
    <link rel="stylesheet" href="/src/css/index.css" />
  </head>
  <body>
    <div class="container">
      <!-- 移动端：横向Tab导航（仅在小屏显示） -->
      <nav id="mobile-tabs" aria-label="主模块切换" role="tablist">
        <button class="tab-btn" role="tab" aria-selected="true" data-target="visualization-panel">地图</button>
        <button class="tab-btn" role="tab" aria-selected="false" data-target="operation-panel">操作</button>
        <button class="tab-btn" role="tab" aria-selected="false" data-target="interpretation-panel">解读</button>
      </nav>
      <!-- 左栏：操作面板 (Operation Panel) -->
      <section class="operation-panel">
        <!-- Control Panel -->
        <div class="control-panel">
          <div class="panel-header">
            <h2>操作面板</h2>
            <p class="panel-subtitle">Operation</p>
          </div>

          <div class="input-section">
            <h3>基础参数</h3>
            <div class="input-group">
              <label for="width-input">地图宽度 (Width)</label>
              <input
                autocomplete="off"
                type="text"
                id="width-input"
                value="500"
                placeholder="10-100000"
              />
            </div>
            <div class="input-group">
              <label for="height-input">地图高度 (Height)</label>
              <input
                autocomplete="off"
                type="text"
                id="height-input"
                value="300"
                placeholder="10-100000"
              />
            </div>
            <div class="input-group">
              <label for="layer-input">层数 (Layers)</label>
              <input
                autocomplete="off"
                type="text"
                id="layer-input"
                value="1"
                placeholder="1-10"
              />
            </div>
            <div class="input-group">
              <label for="obstacle-input">障碍物数量 (Obstacles)</label>
              <input
                autocomplete="off"
                type="text"
                id="obstacle-input"
                value="200"
                placeholder="0-800"
              />
            </div>
          </div>

          <div class="input-section">
            <h3>生成模式</h3>
            <div class="mode-group" id="mode-group" title="生成模式">
              <label class="mode-item"
                ><input
                  type="checkbox"
                  name="mode-option"
                  class="mode-option"
                  data-value="centroid"
                  checked
                />
                质心网络</label
              >
              <label class="mode-item"
                ><input
                  type="checkbox"
                  name="mode-option"
                  class="mode-option"
                  data-value="portal"
                />
                Portal 中点</label
              >
              <label class="mode-item"
                ><input
                  type="checkbox"
                  name="mode-option"
                  class="mode-option"
                  data-value="voronoi"
                />
                Voronoi 骨架</label
              >
            </div>
            <div id="mode-help" class="mode-help">
              <div><strong>模式说明：</strong></div>
              <div>
                • <strong>质心网络</strong>：以 Delaunay 三角形的质心为可行节点
              </div>
              <div>
                • <strong>Portal 中点</strong>：以相邻三角形共享边的中点为
                Portal
              </div>
              <div>
                • <strong>Voronoi 骨架</strong>：以 Voronoi
                边为自由空间中线（实验）
              </div>
            </div>
          </div>

          <details class="advanced-section">
            <summary>高级参数</summary>
            <div class="input-group">
              <label class="input-group-label">
                <input type="checkbox" id="use-spatial-index" checked />
                启用空间索引优化
              </label>
            </div>
            <div
              class="input-group"
              title="用于空间索引的单元格大小（像素）。留空为自动。"
            >
              <label for="cell-size-input">索引单元大小 (cellSize)</label>
              <input
                autocomplete="off"
                type="text"
                id="cell-size-input"
                placeholder="auto"
              />
            </div>
          </details>

          <div class="action-buttons">
            <button id="generate-btn" class="btn-primary">
              <span class="btn__text">生成 / 重置</span>
              <span class="btn__subtitle">Generate / Reset</span>
            </button>
            <div class="button-group">
              <button id="download-btn" class="btn-action" title="下载模型数据">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"
                  />
                </svg>
                <span>Download</span>
              </button>
              <button id="share-btn" class="btn-action" title="分享当前配置">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="18" cy="5" r="3" />
                  <circle cx="6" cy="12" r="3" />
                  <circle cx="18" cy="19" r="3" />
                  <line x1="8.59" y1="13.51" x2="15.42" y2="17.49" />
                  <line x1="15.41" y1="6.51" x2="8.59" y2="10.49" />
                </svg>
                <span>Share</span>
              </button>
            </div>
          </div>

          <div id="status-message" class="status-message">
            <p class="status-text">
              Status: <span class="status-value">Ready</span>
            </p>
            <p class="status-hint">Click "Generate" to start.</p>
          </div>
        </div>
      </section>

      <!-- 中栏：可视化面板 (Visualization Panel) -->
      <section class="visualization-panel">
        <!-- 可视化面板头部 -->
        <div class="visualization-header">
          <div class="header-content">
            <h2>可视化面板</h2>
            <p class="panel-subtitle">Visualization</p>
          </div>
          <!-- 画布工具栏 -->
          <div class="canvas-toolbar">
            <button class="toolbar-btn" id="layer-toggle-btn" title="图层控制">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M12 2L2 7l10 5 10-5-10-5z" />
                <path d="M2 17l10 5 10-5M2 12l10 5 10-5" />
              </svg>
            </button>
            <button class="toolbar-btn" id="zoom-in-btn" title="放大">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="11" cy="11" r="8" />
                <path d="m21 21-4.35-4.35" />
                <path d="M11 8v6M8 11h6" />
              </svg>
            </button>
            <button class="toolbar-btn" id="zoom-out-btn" title="缩小">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="11" cy="11" r="8" />
                <path d="m21 21-4.35-4.35" />
                <path d="M8 11h6" />
              </svg>
            </button>
            <button class="toolbar-btn" id="fullscreen-btn" title="全屏切换">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"
                />
              </svg>
            </button>
          </div>
        </div>

        <div class="canvas-container">
          <!-- 画布区域 -->
          <div id="pixi-canvas"></div>

          <!-- 缩略图导航 -->
          <div class="canvas-navigator">
            <div class="navigator-controls">
              <label for="nav-mode-select" class="sr-only"
                >Navigator Mode</label
              >
              <select id="nav-mode-select" title="缩略图模式">
                <option value="auto" selected>自动</option>
                <option value="heatmap">热力</option>
                <option value="detail">细节</option>
              </select>
            </div>
            <div class="navigator-viewport">
              <canvas id="navigator-canvas"></canvas>
            </div>
          </div>

          <!-- 画布提示信息（简化版） -->
          <div class="canvas-hint">
            <p id="canvas-hint-text">💡 鼠标滚轮缩放，拖拽平移，点击节点进行路径规划</p>
          </div>
        </div>
      </section>

      <!-- 右栏：解读面板 (Interpretation Panel) -->
      <section class="interpretation-panel">
        <div class="interpretation-wrapper">
          <div class="panel-header">
            <h2>数据解读</h2>
            <p class="panel-subtitle">Interpretation</p>
          </div>

          <!-- 图例模块 -->
          <div class="interpretation-card" id="legend-card">
            <h3>图例</h3>
            <div class="legend-grid">
              <div class="legend-item-new" data-layer="obstacles">
                <button
                  class="legend-eye"
                  aria-pressed="true"
                  title="显示/隐藏"
                ></button>
                <span
                  class="legend-icon obstacle-icon"
                  aria-hidden="true"
                ></span>
                <span class="legend-label">障碍物</span>
              </div>
              <div class="legend-item-new" data-layer="networkNodes">
                <button
                  class="legend-eye"
                  aria-pressed="true"
                  title="显示/隐藏"
                ></button>
                <span class="legend-icon node-icon" aria-hidden="true"></span>
                <span class="legend-label">网络节点</span>
              </div>
              <div class="legend-item-new" data-layer="networkEdges">
                <button
                  class="legend-eye"
                  aria-pressed="true"
                  title="显示/隐藏"
                ></button>
                <span class="legend-icon edge-icon" aria-hidden="true"></span>
                <span class="legend-label">网络边</span>
              </div>
              <div class="legend-item-new" data-layer="baseTriangulation">
                <button
                  class="legend-eye"
                  aria-pressed="true"
                  title="显示/隐藏"
                ></button>
                <span class="legend-icon base-icon" aria-hidden="true"></span>
                <span class="legend-label">基础三角化</span>
              </div>
              <div class="legend-item-new" data-layer="voronoi">
                <button
                  class="legend-eye"
                  aria-pressed="true"
                  title="显示/隐藏"
                ></button>
                <span
                  class="legend-icon voronoi-icon"
                  aria-hidden="true"
                ></span>
                <span class="legend-label">Voronoi 骨架</span>
              </div>
              <div class="legend-sep"></div>
              <div class="legend-item-new-wrap">
                <div class="legend-item-new" aria-hidden="true">
                  <span class="legend-icon start-icon"></span>
                  <span class="legend-label">起点</span>
                </div>
                <div class="legend-item-new" aria-hidden="true">
                  <span class="legend-icon end-icon"></span>
                  <span class="legend-label">终点</span>
                </div>
                <div class="legend-item-new" aria-hidden="true">
                  <span class="legend-icon path-icon"></span>
                  <span class="legend-label">路径</span>
                </div>
              </div>
            </div>
          </div>

          <!-- 路径统计模块 -->
          <div class="interpretation-card" id="path-card">
            <div class="card-header-row">
              <h3>路径统计</h3>
              <div class="card-actions">
                <button
                  id="path-refresh-btn"
                  class="btn-secondary btn-compact"
                  title="刷新上次路径"
                >
                  刷新
                </button>
                <button
                  id="path-clear-btn"
                  class="btn-secondary btn-compact"
                  title="清空当前路径"
                >
                  清空
                </button>
                <button
                  id="path-collapse-btn"
                  class="btn-secondary btn-icon"
                  title="折叠/展开"
                  aria-expanded="true"
                >
                  ▾
                </button>
              </div>
            </div>
            <div id="path-stats" class="stats-grid">
              <div class="stat-item">
                <span class="stat-label">当前路径</span>
                <span class="stat-value" id="path-status">未选择</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">路径长度</span>
                <span class="stat-value" id="path-length">--</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">节点数量</span>
                <span class="stat-value" id="path-nodes">--</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">转折次数</span>
                <span class="stat-value" id="path-turns">--</span>
              </div>
            </div>
            <div id="path-info" class="path-detail">
              <p>💡 点击画布上的节点选择起点和终点，系统将自动计算最短路径</p>
            </div>
          </div>

          <!-- 性能数据模块 -->
          <div class="interpretation-card" id="perf-card">
            <div class="card-header-row">
              <h3>性能数据</h3>
              <span
                id="perf-status-dot"
                class="status-dot ok"
                title="系统状态"
              ></span>
            </div>
            <div class="stats-grid">
              <div class="stat-item">
                <span class="stat-label">总节点数</span>
                <span class="stat-value" id="node-count">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">总边数</span>
                <span class="stat-value" id="edge-count">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">层数</span>
                <span class="stat-value" id="layer-count">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">生成耗时</span>
                <span class="stat-value" id="gen-time">-- ms</span>
              </div>
            </div>
            <div id="perf-info" class="perf-detail">
              <p>等待生成模型...</p>
            </div>
          </div>

          <!-- 洞察与提示模块 -->
          <div class="interpretation-card">
            <h3>操作提示</h3>
            <div class="insights-list">
              <div class="insight-item">
                <span class="insight-icon">•</span>
                <span class="insight-text"
                  >悬停：显示白色十字星，定位最近节点</span
                >
              </div>
              <div class="insight-item">
                <span class="insight-icon">•</span>
                <span class="insight-text"
                  >点击：第一次选择<strong>起点</strong>，第二次选择<strong
                    >终点</strong
                  ></span
                >
              </div>
              <div class="insight-item">
                <span class="insight-icon">•</span>
                <span class="insight-text"
                  >自动寻路：使用 A* 算法计算最短路径</span
                >
              </div>
              <div class="insight-item">
                <span class="insight-icon">•</span>
                <span class="insight-text"
                  >鼠标滚轮：缩放画布；拖拽：平移视图</span
                >
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <script type="module" src="/src/main.js"></script>
    <script type="module" src="/src/utils/mobileUI.js"></script>
  </body>
</html>
